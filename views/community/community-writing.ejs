<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>ì»¤ë®¤ë‹ˆí‹° ì‘ì„±</title>
        <link rel="icon" href="/public/img/icon/logoico.ico" />
        <link rel="stylesheet" href="/public/css/community-writing.css" />
        <link rel="stylesheet" href="/public/css/font.css" />
        <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    </head>
    <body>
        <header>
            <div class="headbtn">
                <!-- <div class="login" onclick="window.location.href = '/user/login';">ë¡œê·¸ì¸</div>
                <div class="sign" onclick="window.location.href = '/user/signup';">íšŒì›ê°€ì…</div>
                <div class="mypage">ë§ˆì´í˜ì´ì§€</div> -->
            </div>
            <div class="headertitle">
                <img src="/public/img/ê½ƒ.png" alt="ê½ƒ" />
                ì»¤ë®¤ë‹ˆí‹° ê¸€ ì‘ì„±
            </div>
            <div class="banner">
                <div class="bannerleft">
                    <span onclick="window.location.href = '/employ/board';">ì±„ìš©ì •ë³´</span>
                    <span onclick="window.location.href = '/market/board';">ë²¼ë£©ì‹œì¥</span>
                </div>
                <div class="bannerright">
                    <span onclick="window.location.href = '/community/board';">ì»¤ë®¤ë‹ˆí‹°</span>
                    <span onclick="window.location.href = '/resume/mypage';">My êµ¬ì¸êµ¬ì§</span>
                </div>
            </div>
        </header>
        <div style="text-align: right">
            ë³¸ ê²Œì‹œíŒì˜ ì„±ê²©ê³¼ ë§ì§€ ì•ŠëŠ” ê¸€ ë° ê´‘ê³  ê´€ë ¨ ê¸€ì€ ë¸”ë¼ì¸ë“œ ì²˜ë¦¬ ë˜ëŠ” ì‚­ì œ ë©ë‹ˆë‹¤.
        </div>
        <div class="notiffont"><span style="color: red">*</span>&nbsp;í‘œì‹œëŠ” í•„ìˆ˜í•­ëª©ì…ë‹ˆë‹¤.</div>
        <div class="comwrtablebox">
            <table class="comwrtable">
                <thead>
                    <th><span style="color: red">*</span>&nbsp;ì•„ì´ë””</th>
                    <th><input type="text" id="id" style="width: 50%" /></th>
                </thead>
                <tbody>
                    <tr>
                        <td>E-mail</td>
                        <td><input type="email" id="email" style="width: 50%" /></td>
                    </tr>
                    <tr>
                        <td><span style="color: red">*</span>&nbsp;ë¶„ë¥˜</td>
                        <td>
                            <select class="groupselecect" id="group">
                                <option disabled selected>ì „ì²´</option>
                                <option>ìœ ì¹˜ì›</option>
                                <option>ì–´ë¦°ì´ì§‘</option>
                                <option>ë†€ì´í•™êµ</option>
                                <option>ë¯¸ìˆ í•™ì›</option>
                                <option>ë†€ì´í•™ì›</option>
                                <option>ê¸°íƒ€</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td><span style="color: red">*</span>&nbsp;ê¸€ ì œëª©</td>
                        <td><input type="text" style="width: 80%" id="title" /></td>
                    </tr>
                    <tr>
                        <td><span style="color: red">*</span>&nbsp;ë‚´ìš©</td>
                        <td><textarea id="content" cols="80" rows="10"></textarea></td>
                    </tr>
                    <tr>
                        <td>íŒŒì¼ì²¨ë¶€</td>
                        <td>ë‚˜ì¤‘ì—,,</td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="btnCollection">
            <div>
                <button type="button" onclick="window.location.href = '/community/board';">ëª©ë¡</button>
            </div>
            <div>
                <button type="button">ìˆ˜ì •</button>
                <button type="button">ì‚­ì œ</button>
                <button type="button" onclick="submit()">ë“±ë¡í•˜ê¸°</button>
            </div>
        </div>
        <%- include('../sidebar.ejs') %> <%- include('../footer.ejs') %>
        <script>
            //í† í° ì—†ìœ¼ë©´ ë“¤ì–´ê°€ì§€ ëª»í•˜ê²Œ ì˜ˆì™¸ì²˜ë¦¬
            (function () {
                if (localStorage.getItem('token') === null) {
                    alert('ë¡œê·¸ì¸ í›„ ì´ìš©ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                    document.location.href = '/community/board';
                }
            })();
            async function submit() {
                const data = {
                    community_id: document.querySelector('#id').value,
                    com_mail: document.querySelector('#email').value,
                    com_division: document.querySelector('#group').value,
                    com_title: document.querySelector('#title').value,
                    com_content: document.querySelector('#content').value,
                    // pd_picture
                };
                if (!data.community_id || !data.com_division || !data.com_title || !data.com_content) {
                    alert('ì…ë ¥ê°’ì„ ëª¨ë‘ ì±„ì›Œì£¼ì„¸ìš”.');
                    return;
                }
                const res = await axios({
                    method: 'POST',
                    url: '/api/community/write',
                    data,
                    headers: {
                        Authorization: `Bearer ${localStorage.getItem('token')}`,
                    },
                });
                console.log('res', res);
                const { success, result } = res.data;
                console.log(res.data);
                if (success) {
                    alert('ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤');
                    document.location.href = '/community/board';
                }
            }
            //ëª¨ë“  í˜ì´ì§€ì— ì¶”ê°€!
            window.onload = function () {
                const token = localStorage.getItem('token');
                const userName = localStorage.getItem('user_name');
                if (token) {
                    document.querySelector(
                        '.headbtn'
                    ).innerHTML = `<span><a href="" class="mypage">${userName}</a>ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤ğŸ’›</span>
        &nbsp;&nbsp;<button type = "button" onclick = "logout()" class = "logout">ë¡œê·¸ì•„ì›ƒ</button>`;
                } else {
                    document.querySelector(
                        '.headbtn'
                    ).innerHTML = `<a href="/user/login" class="login btn-gradient">ë¡œê·¸ì¸</a>
             <a href="/user/signup" class="sign btn-gradient">íšŒì›ê°€ì…</a>
             `;
                }
                //<a href="" class="mypage">ë§ˆì´í˜ì´ì§€</a>
            };
            function logout() {
                localStorage.removeItem('token');
                localStorage.removeItem('user_name');
                alert('ë¡œê·¸ì•„ì›ƒ ë˜ì—ˆìŠµë‹ˆë‹¤.');
                window.location.href = '/';

                // window.location.reload(); // í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ì—¬ ë¡œê·¸ì¸ ìƒíƒœë¥¼ ì—…ë°ì´íŠ¸
            }
        </script>
    </body>
</html>
